<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monad 综合管理系统</title>
    <style>
        /* 完整导航系统样式 */
        :root {
            --sidebar-width: 280px;
            --primary-color: #2c3e50;
            --active-color: #3498db;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, sans-serif;
        }
        body {
            background: #f8f9fa;
            min-height: 100vh;
        }
        .nav-container {
            position: fixed;
            width: var(--sidebar-width);
            height: 100vh;
            background: var(--primary-color);
            padding: 2rem 0;
            box-shadow: 2px 0 12px rgba(0,0,0,0.1);
        }
        .nav-item {
            padding: 1.2rem 2rem;
            color: rgba(255,255,255,0.9);
            cursor: pointer;
            transition: 0.3s;
            border-left: 4px solid transparent;
        }
        .nav-item.active {
            background: rgba(255,255,255,0.05);
            border-left-color: var(--active-color);
        }

        /* 完整钱包系统样式 */
        .wallet-module {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            padding: 2rem;
            margin-left: var(--sidebar-width);
        }
        .wallet-module .control-panel {
            display: grid;
            grid-template-columns: repeat(3,1fr);
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        .wallet-module input,
        .wallet-module select {
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: 6px;
            width: 100%;
        }
        .wallet-module button {
            background: #2196F3;
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            width: 100%;
        }
        .wallet-module table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 2rem;
        }
        .wallet-module th,
        .wallet-module td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        /* 完整项目系统样式 */
        .project-module {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            padding: 2rem;
            margin-left: var(--sidebar-width);
            display: none;
        }
        .project-module .batch-input {
            width: 100%;
            height: 150px;
            padding: 1rem;
            border: 2px solid #2196F3;
            border-radius: 8px;
            margin: 1.5rem 0;
        }
        .project-module .task-button {
            padding: 1rem 2rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            min-width: 200px;
        }
        .project-module .success {
            background: #4CAF50;
            color: white;
        }
        .project-module .primary {
            background: #2196F3;
            color: white;
        }
        .project-module .danger {
            background: #f44336;
            color: white;
        }
    </style>
</head>
<body>
    <!-- 完整导航结构 -->
    <nav class="nav-container">
        <div class="nav-item active" data-module="wallet">钱包管理系统</div>
        <div class="nav-item" data-module="project">项目管理系统</div>
    </nav>

    <!-- 钱包系统完整HTML -->
    <div class="wallet-module">
        <div class="control-panel">
            <div class="input-group">
                <label>API密钥:</label>
                <input type="text" id="apiKey" placeholder="输入API密钥">
            </div>
            <div class="input-group">
                <label>查询线程数:</label>
                <select id="threads">
                    <option value="1">1线程</option>
                    <option value="2">2线程</option>
                    <option value="3" selected>3线程</option>
                    <option value="4">4线程</option>
                </select>
            </div>
            <div class="input-group">
                <label>线程间隔(ms):</label>
                <input type="number" id="interval" value="1000" min="500">
            </div>
        </div>
        <textarea id="addresses" placeholder="输入钱包地址，每行一个"></textarea>
        <button onclick="startAnalysis()">开始查询</button>
        <div class="stats-bar" id="globalStats">
            <div style="display:flex;gap:2rem;margin:2rem 0">
                <div>
                    <span style="color:#666">总 MON:</span>
                    <span id="totalMON" style="font-weight:bold;color:#2196F3">0.0000</span>
                </div>
                <div>
                    <span style="color:#666">总质押aprMON:</span>
                    <span id="totalAprMON" style="font-weight:bold;color:#2196F3">0.0000</span>
                </div>
            </div>
        </div>
        <table class="address-table">
            <thead>
                <tr>
                    <th>序号</th>
                    <th>地址</th>
                    <th>MON余额</th>
                    <th>aprMON余额</th>
                    <th>交易记录</th>
                </tr>
            </thead>
            <tbody id="resultBody"></tbody>
        </table>
    </div>

    <!-- 项目系统完整HTML -->
    <div class="project-module">
        <div class="stats-card">
            <h2>项目统计</h2>
            <div style="display:flex;gap:2rem;margin-bottom:1.5rem">
                <div>
                    <span style="color:#666">已打开：</span>
                    <span id="openedCount" style="color:#2196F3;font-weight:bold">0</span>
                </div>
                <div>
                    <span style="color:#666">未打开：</span>
                    <span id="unopenedCount" style="color:#2196F3;font-weight:bold">0</span>
                </div>
            </div>
            <h3>批量添加项目</h3>
            <textarea class="batch-input" id="batchInput" placeholder="批量导入项目网址（每行一个）"></textarea>
            <div style="display:flex;gap:1rem;margin:1.5rem 0">
                <button class="task-button success" onclick="batchAddProjects()">批量导入项目</button>
                <button class="task-button primary" onclick="openRandomProject()">随机打开任务</button>
                <button class="task-button danger" onclick="clearProgress()">重置所有已打开</button>
            </div>
            <div style="display:flex;align-items:center;gap:1rem;margin:1.5rem 0">
                <input type="checkbox" id="selectAll" onchange="toggleSelectAll(this.checked)" style="transform:scale(1.2)">
                <label for="selectAll">全选</label>
                <button class="task-button danger" onclick="batchDelete()">批量删除选中项</button>
            </div>
        </div>
        <div class="project-list">
            <div id="projectList"></div>
        </div>
    </div>

    <script>
        // 完整导航交互逻辑
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', function() {
                document.querySelector('.nav-item.active').classList.remove('active');
                this.classList.add('active');
                
                const targetModule = this.dataset.module;
                document.querySelectorAll('.wallet-module, .project-module').forEach(module => {
                    module.style.display = 'none';
                });
                document.querySelector(`.${targetModule}`).style.display = 'block';
            });
        });

        // 完整钱包系统脚本
        ;(function(){
            const API_CONFIG = {
                tokens: 'https://api.blockvision.org/v2/monad/account/tokens',
                transactions: 'https://api.blockvision.org/v2/monad/account/transactions',
                activities: 'https://api.blockvision.org/v2/monad/account/activities',
                internal: 'https://api.blockvision.org/v2/monad/account/internal/transactions'
            };

            class AddressAnalyzer {
                constructor() {
                    this.jobQueue = [];
                    this.currentIndex = 0;
                    this.results = [];
                    this.total = 0;
                    this.interval = 1000;
                    this.threads = 3;
                    this.running = false;
                }

                init(apiKey, addresses, threads, interval) {
                    this.apiKey = apiKey;
                    this.addresses = addresses;
                    this.threads = threads;
                    this.interval = interval;
                    this.total = addresses.length;
                    this.results = [];
                }

                async fetchData(url, address) {
                    try {
                        const response = await fetch(`${url}/${address}?apiKey=${this.apiKey}`);
                        return await response.json();
                    } catch (error) {
                        console.error('请求失败:', error);
                        return null;
                    }
                }

                async processAddress(address, index) {
                    const [tokens, transactions, activities, internal] = await Promise.all([
                        this.fetchData(API_CONFIG.tokens, address),
                        this.fetchData(API_CONFIG.transactions, address),
                        this.fetchData(API_CONFIG.activities, address),
                        this.fetchData(API_CONFIG.internal, address)
                    ]);

                    const monBalance = tokens?.data?.find(t => t.symbol === 'MON')?.balance || 0;
                    const aprMonBalance = tokens?.data?.find(t => t.symbol === 'aprMON')?.balance || 0;

                    return {
                        index: index + 1,
                        address,
                        monBalance,
                        aprMonBalance,
                        transactions: transactions?.data?.length || 0,
                        activities: activities?.data?.length || 0,
                        internal: internal?.data?.length || 0
                    };
                }

                async start() {
                    if (this.running) return;
                    this.running = true;
                    
                    const worker = async () => {
                        while (this.currentIndex < this.addresses.length) {
                            const address = this.addresses[this.currentIndex];
                            this.currentIndex++;
                            
                            const result = await this.processAddress(address, this.currentIndex);
                            this.results.push(result);
                            
                            // 更新UI
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td>${result.index}</td>
                                <td>${result.address}</td>
                                <td>${result.monBalance.toFixed(4)}</td>
                                <td>${result.aprMonBalance.toFixed(4)}</td>
                                <td>${result.transactions}</td>
                            `;
                            document.getElementById('resultBody').appendChild(row);
                            
                            // 更新统计
                            document.getElementById('totalMON').textContent = this.results
                                .reduce((sum, r) => sum + r.monBalance, 0).toFixed(4);
                            document.getElementById('totalAprMON').textContent = this.results
                                .reduce((sum, r) => sum + r.aprMonBalance, 0).toFixed(4);
                            
                            await new Promise(resolve => setTimeout(resolve, this.interval));
                        }
                        this.running = false;
                    };

                    // 启动多个线程
                    const workers = Array(this.threads).fill().map(() => worker());
                    await Promise.all(workers);
                }
            }

            window.startAnalysis = async function() {
                const apiKey = document.getElementById('apiKey').value.trim();
                const addresses = document.getElementById('addresses').value
                    .split('\n')
                    .map(a => a.trim())
                    .filter(a => a.startsWith('0x') && a.length === 42);

                if (!apiKey) return alert('请输入API密钥');
                if (!addresses.length) return alert('请输入有效的钱包地址');

                // 清空结果
                document.getElementById('resultBody').innerHTML = '';
                document.getElementById('totalMON').textContent = '0.0000';
                document.getElementById('totalAprMON').textContent = '0.0000';

                const analyzer = new AddressAnalyzer();
                analyzer.init(
                    apiKey,
                    addresses,
                    parseInt(document.getElementById('threads').value),
                    parseInt(document.getElementById('interval').value)
                );

                try {
                    await analyzer.start();
                } catch (error) {
                    console.error('查询流程失败:', error);
                }
            };
        })();

        // 完整项目系统脚本
        ;(function(){
            let projects = JSON.parse(localStorage.getItem('projects')) || [];
            let openedProjects = JSON.parse(localStorage.getItem('openedProjects')) || [];
            let selectedProjects = new Set();

            function generateProjectName(url) {
                try {
                    const urlObj = new URL(url);
                    let hostname = urlObj.hostname.replace(/^www\./, '');
                    let path = urlObj.pathname.replace(/^\//, '').split('/')[0];
                    const nameParts = [
                        hostname.split('.')[0],
                        path.replace(/[^a-zA-Z0-9]/g, ' ')
                    ].filter(Boolean);
                    return nameParts.map(part => 
                        part.replace(/(^\w|\s\w)/g, m => m.toUpperCase())
                    ).join(' ');
                } catch {
                    return url.replace(/^https?:\/\//, '').split('/')[0];
                }
            }

            function updateProjectList() {
                const listElement = document.getElementById('projectList');
                listElement.innerHTML = '';
                
                projects.forEach((project, index) => {
                    const projectElement = document.createElement('div');
                    projectElement.className = 'project-item';
                    projectElement.innerHTML = `
                        <div style="display:flex;align-items:center;gap:1rem;padding:1rem;border-bottom:1px solid #eee">
                            <input type="checkbox" ${selectedProjects.has(index) ? 'checked' : ''} 
                                onchange="toggleProjectSelection(${index}, this.checked)">
                            <span style="flex:1">${project.name}</span>
                            <span style="color:${openedProjects.includes(project.url) ? '#4CAF50' : '#666'}">
                                ${openedProjects.includes(project.url) ? '已打开' : '未打开'}
                            </span>
                        </div>
                    `;
                    listElement.appendChild(projectElement);
                });

                document.getElementById('openedCount').textContent = openedProjects.length;
                document.getElementById('unopenedCount').textContent = projects.length - openedProjects.length;
            }

            window.batchAddProjects = function() {
                const input = document.getElementById('batchInput').value;
                const newProjects = input.split('\n')
                    .map(line => line.trim())
                    .filter(line => line)
                    .map(url => {
                        if (!url.startsWith('http')) url = `https://${url}`;
                        return { name: generateProjectName(url), url: url };
                    });

                const existingUrls = new Set(projects.map(p => p.url));
                const uniqueProjects = newProjects.filter(p => 
                    !existingUrls.has(p.url) && 
                    /^https?:\/\//.test(p.url)
                );
                
                projects = [...projects, ...uniqueProjects];
                localStorage.setItem('projects', JSON.stringify(projects));
                updateProjectList();
                alert(`成功导入 ${uniqueProjects.length} 个新项目！`);
            };

            window.toggleSelectAll = function(checked) {
                selectedProjects.clear();
                if (checked) {
                    projects.forEach((_, index) => selectedProjects.add(index));
                }
                updateProjectList();
            };

            window.batchDelete = function() {
                projects = projects.filter((_, index) => !selectedProjects.has(index));
                selectedProjects.clear();
                localStorage.setItem('projects', JSON.stringify(projects));
                updateProjectList();
            };

            window.openRandomProject = function() {
                const unopened = projects.filter(p => !openedProjects.includes(p.url));
                if (unopened.length === 0) return alert('所有项目均已打开');
                
                const randomIndex = Math.floor(Math.random() * unopened.length);
                const project = unopened[randomIndex];
                openedProjects.push(project.url);
                localStorage.setItem('openedProjects', JSON.stringify(openedProjects));
                updateProjectList();
                window.open(project.url, '_blank');
            };

            window.clearProgress = function() {
                openedProjects = [];
                localStorage.setItem('openedProjects', JSON.stringify(openedProjects));
                updateProjectList();
            };

            // 初始化项目列表
            updateProjectList();
        })();
    </script>
</body>
</html>
